IPv6
####
:date: 2019-10-14 18:43
:author: rainasmoon
:category: 做生意
:slug: ipv6
:status: published

IPv6为下一代的IP技术规范，它已经不同于IPv4。一些新的技术被提了出来。IPv6现在处在一个什么样的阶段？IPv6又能给我们带来多少的好处？我要如何实现一个家庭IPv6的网络？

| 
|  
|  

IPv6概述
========

IPv6可以给每一个设备全球唯一的一个地址。如果防火墙规则允许，无论在哪里都可以访问到每一台设备。

ipv6由原来的32位扩展到了128位。即从8位\*4组扩充到了16位\*8组。ipv6由原来ipv4的10进制表示法改变成了16进制表示法。

ipv6有三种表示法
================

一：冒分十六进制
----------------

X:X:X:X:X:X:X:X

二：0位压缩表示法
-----------------

FF01:0:0:0:0:0:0:1=FF01::1

0:0:0:0:0:0:0:1=::1

0:0:0:0:0:0:0:0=::

三：内嵌ipv4表示法
------------------

X:X:X:X:X:X:d.d.d.d

::192.168.0.1

::FFFF:192.168.0.1

ipv6地址的分类：
================

单播地址：
----------

::/128 -> 未指定地址

::1/128 -> loop地址，相当于127.0.0.1

FE80::/10 -> 链路本地地址，相当于192.168.0.0/16

FC00::/7 ->唯一本地地址。

FD00::/8 ->

FC00::/8 -> 不常用。

FEC0::/10 -> 已经弃用。站点本地地址。

FF00::/8 -> 组播地址

一、全球单播地址：等同于IPv4中的公网地址，可以在IPv6 Internet上进行全局路由和访问。前三个bit是001。

二、本地单播地址： 链路本地地址和唯一本地地址都属于本地单播地址，也就是IPV4地址中局域网专用地址。每个接口上至少要有一个链路本地单播地址，另外还可分配任何类型（单播、任播和组播）或范围的IPv6地址。

(1)链路本地地址（FE80::/10）：仅用于单个链路（链路层不能跨VLAN），不能在不同子网中路由。结点使用链路本地地址与同一个链路上的相邻结点进行通信。 相当于IPv4里面的169.254.0.0/16地址。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是fe80::/64。

(2)唯一本地地址（FC00::/7）：唯一本地地址是本地全局的，它应用于本地通信，但不通过Internet路由，将其范围限制为组织的边界。

(3)站点本地地址（FEC0::/10，新标准中已被唯一本地地址代替）

三、兼容性地址：在IPv6的转换机制中还包括了一种通过IPv4路由接口以隧道方式动态传递IPv6包的技术。这样的IPv6结点会被分配一个在低32位中带有全球IPv4单播地址的IPv6全局单播地址。

已经废弃。

四、特殊地址：

未指定地址（0:0:0:0:0:0:0:0或::）仅用于表示某个地址不存在。它等价于IPv4未指定地址0.0.0.0。未指定地址通常被用做尝试验证暂定地址唯一性数据包的源地址，并且永远不会指派给某个接口或被用做目标地址。

环回地址（0:0:0:0:0:0:0:1或::1）用于标识环回接口，允许节点将数据包发送给自己。它等价于IPv4环回地址127.0.0.1。发送到环回地址的数据包永远不会发送给某个链接，也永远不会通过IPv6路由器转发。

ULA
===

唯一的本地IPv6单播地址（ULA，Unique Local IPv6 Unicast Address）在RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FD00::/8，后面跟一个被称为全局ID的40bit随机标识符。

多播IPv6地址（Multicast IPv6 Addresses）
========================================

前8个bit为1111 1111， 其中FF01::到FF0F::的多播地址是保留专用地址：

-  FF01::1 节点本地范围所有节点多播地址
-  FF02::1 链路本地范围所有节点多播地址
-  FF01::2 节点本地范围所有路由器多播地址
-  FF02::2 链路本地范围所有路由器多播地址
-  FF05::2 站点本地范围所有路由器多播地址

子网
====

ipv4是通过子网掩码来区分子网的。而IPv6则直接把前64位做为子网。前48 位为全局地址前缀。接下来的 16 位为子网 ID 字段。后64位为主机ID。

对于全局地址，Internet 编号分配机构 (IANA) 或 ISP 会分配一个前 48 位均为固定位的 IPv6 地址前缀。

地址前缀即相当于原ipv4的子网掩码。

IPv6的地址作用范围
==================

Global，组织内，link，host

Global：全球唯一，以bit001开头。

link内的：链路内，不会被路由器转发。以FE80开头。

host：特指::1

广播地址：以FF开头。

ipv6有两种配置方式：
====================

方式一：主机自动计算。这不同于ipv4的地址分配方式。

方式二：dhcpv6分发，和ipv4类似。

DHCPv6客户端，用于动态获取IPv6地址、IPv6前缀或其他网络配置参数；

DHCPv6服务器，负责为DHCPv6客户端分配IPv6地址、IPv6前缀和其他配置参数；

DHCPv6中继，它是一个转发设备。

ipv6 routed prefix：即传统的子网掩码。

Router Advertisement：做为路由器的一个职责。用于自动配置IPV6地址。

NDP-Proxy：邻居发现协议。

DHCPv6-Mode：stateless，stateful

连接特定的DNS后缀

两个IPV6地址

临时IPV6地址

本地链接IPv6地址：scope为link的地址。

scope：host，link，global

Proxy Neighbour Discovery Protocol（邻居发现协议） ：为ARP的替代协议。

IPv6的特点：
============

IPv6设计之初就把地址从用户拥有改成运营商拥有。 ICMPv6新增加的邻居发现功能代替了ARP协议的功能，所以在IPv6体系结构中已经没有ARP协议了。

IPv6使用更小的路由表。IPv6的地址分配一开始就遵循聚类（Aggregation）的原则，这使得路由器能在路由表中用一条记录（Entry）表示一片子网。

IPv6增加了增强的组播（Multicast）支持以及对流的控制（Flow Control），这使得网络上的多媒体应用有了长足发展的机会，为服务质量（QoS，Quality of Service）控制提供了良好的网络平台。

IPv6加入了对自动配置（Auto Configuration）的支持。这是对DHCP协议的改进和扩展，使得网络（尤其是局域网）的管理更加方便和快捷。

IPv6实现了IP级的安全。

过渡技术：
==========

双协议栈、隧道技术以及网络地址转换。

ISATAP：网络地址转换。可以使ipv6安全的通过ipv4网络。

在IPV4隧道中传递IPV6: 6rd, 6to4, 6in4.

在IPV6隧道中传递IPV4 : ds-lite。

IPv4的遇到的问题
================

NAT：网络地址转换。由于IPv4的个数有限，并不能保证每一台独立上网的公共ip。而产生的技术，即地址转换。

double NAT：经过两次甚至三次的地址转化。

ARP：在IPv6里被网上邻居发现协议替换。

家用路由器IPv6的设置：
======================

光猫：中国电信提供的光纤接入设备。

网关：上外网。

路由器：路由连通到不同的网络。

NAT：

透传：把内网暴露到外网。

IPv6的dhcpv6的relay模式：如果使用了中国电信的光猫。并且开通的IPv6和dhcpv6。则后接的第二台路由器ipv4使用原有模式。而IPv6因为没有了NAT，则必须使用relay模式。即把ip的分配置交给了光猫。

IPv6的子网划分，子网掩码即为网络前缀。与 IPv4 不同的是，无法使用可变长度子网划分来创建不同大小的子网，因为所有 IPv6 子网都使用 64 位网络 ID 和 64 位接口 ID。

边界网关协议：在边界网关协议里规定了哪些ip会被路由。那些不会被路由。

IPv6的前景：
============

总体来说，全球IPv6技术的发展不断进行着，并且随着IPv4消耗殆尽，许多国家已经意识到了IPv6技术所带来的优势，推动了IPv6下一代互联网全面部署和大规模商用。

随着IPv6的各项技术日趋完美，IPv6成本过高，发展缓慢，支持度不够等问题将很快淡出人们的视野。

学习IPv6设备：
==============

`树莓派4B Raspberry Pi <https://union-click.jd.com/jdc?e=&p=AyIGZRtSFQcbBFUSWBAyFgdXHVoXBxMBVRhrUV1KWQorAlBHU0VeBUVNR0ZbSkdETlcNVQtHRVNSUVNLXANBRA1XB14DS10cQQVYD21XHgNVGV0UABcGUxtYJWFxZwFkHGBwcXgdXDBdck8FPmVZZlQeC2UaaxUDEwdQGFocCxQ3ZRtcJUN8B1QbWBAKEw5lGmsVBhQHVB9aEQobDlMdaxICGzcWSwNKUlBbC0UEJTIiBGUraxUyETcXdVMTAkdQVhlTE1VGUFBJD0VSRgMCS1hCBhcDV0kORVJBN1caWhEL>`__

为aws打开IPv6：
---------------

1 为VPC添加IPv6 CIDR。

2 为subnet添加IPv6 CIDR。并打开允许自动获得IPv6地址。

3 检查security group是否打开了IPv6的端口。

4 检查实例的网络-》IP adress management -》 为实例分配IPv6 address.

5 为VPC添加IPv6的路由规则。

为阿里云打开IPV6：
------------------

阿里云的IPV6目前还处在邀请内测的阶段，除了申请内测，还没有方便的办法直接打开。

为家用路由器及电脑打开IPV6：
----------------------------

家里的新买的路由器及电脑已经全部都支持IPV6了。上网的服务提供商也已经支持了IPV6。只是有的支持得好，速度快，有的支持得不好，速度有限制而已。

如果遇到支持好的，相当于赚到了。网速会有提升的。

浏览器目前默认使用ipv4。如果强制使用IPV6需要特别的配置。很多家用电器很可能现在只支持到了IPV4。

可以指定网址专门使用ipv6。如：\ http://ipv6.baidu.com/

命令：
======

ping -6 ipv6.baidu.com

nslookup baidu.com 222.222.202.202

FAQ：
=====

1 PPPoe

调制解调器的拨号上网，使用的是PPP协议，即Point to Point Protocol，点到点协议，该协议具有用户认证及通知IP地址的功能。PPP over Ethernet(PPPoE)协议，是在以太网络中转播PPP帧信息的技术，尤其适用于ADSL等方式。

2 IPoe

基于上网用户的物理位置（通过唯一的VLAN ID/PVC ID标示）对用户进行认证和计费，用户上网时无需输入用户名和密码。

参考：
======

-  https://docs.aws.amazon.com/zh\_cn/vpc/latest/userguide/vpc-migrate-ipv6.html
-  


